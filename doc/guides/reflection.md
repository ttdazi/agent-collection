# åæ€æœºåˆ¶ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

åæ€æœºåˆ¶ï¼ˆReflectionï¼‰æ˜¯ä¸€ç§å¢å¼ºAI Agentèƒ½åŠ›çš„æœºåˆ¶ï¼Œé€šè¿‡è‡ªæˆ‘è¯„ä¼°å’Œåé¦ˆæ¥æ”¹è¿›æ¨¡å‹çš„è¾“å‡ºè´¨é‡ã€‚æœ¬ç³»ç»Ÿä½¿ç”¨LangGraphå®ç°äº†å®Œæ•´çš„åæ€å·¥ä½œæµã€‚

## å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥
    â†“
[æ‰§è¡ŒAgent] â†’ åˆå§‹è¾“å‡º
    â†“
[åæ€è¯„ä¼°] â†’ è¯„ä¼°ç»“æœ
    â†“
[æ”¹è¿›è¾“å‡º] â†’ æ”¹è¿›åçš„è¾“å‡º
    â†“
[åˆ¤æ–­] â†’ æ˜¯å¦éœ€è¦ç»§ç»­ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ å›åˆ°[åæ€è¯„ä¼°]ï¼ˆæœ€å¤šè¿­ä»£Næ¬¡ï¼‰
    â””â”€ å¦ â†’ [ç”Ÿæˆæœ€ç»ˆè¾“å‡º]
```

## é…ç½®

åœ¨ `config.py` ä¸­é…ç½®åæ€æœºåˆ¶ï¼š

```python
"reflection": {
    "enable": False,  # æ˜¯å¦å¯ç”¨åæ€æœºåˆ¶
    "max_iterations": 2,  # æœ€å¤§åæ€è¿­ä»£æ¬¡æ•°
    "log_reflection": True,  # æ˜¯å¦è®°å½•åæ€è¿‡ç¨‹
}
```

## ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

é¦–å…ˆå®‰è£…LangGraphï¼š

```bash
pip install langgraph>=0.2.0
```

æˆ–è€…å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š

```bash
pip install -r requirements.txt
```

### 2. å¯ç”¨åæ€æœºåˆ¶

åœ¨ `config.py` ä¸­è®¾ç½®ï¼š

```python
"reflection": {
    "enable": True,  # å¯ç”¨åæ€æœºåˆ¶
    "max_iterations": 2,  # æœ€å¤šåæ€2æ¬¡
    "log_reflection": True,  # è®°å½•åæ€è¿‡ç¨‹
}
```

### 3. ä½¿ç”¨Agent

å¯ç”¨åæ€æœºåˆ¶åï¼ŒAgentä¼šè‡ªåŠ¨ä½¿ç”¨åæ€å·¥ä½œæµï¼š

```python
from core.agent_service import agent_service

result = agent_service.invoke_agent(
    agent_name="joke",
    user_input="è®²ä¸ªç¬‘è¯"
)

# ç»“æœåŒ…å«ï¼š
# - output: æœ€ç»ˆè¾“å‡ºï¼ˆç»è¿‡åæ€æ”¹è¿›ï¼‰
# - reflection_metadata: åæ€å…ƒæ•°æ®
#   - iterations: è¿­ä»£æ¬¡æ•°
#   - reflection: åæ€è¯„ä¼°ç»“æœ
#   - original_output: åŸå§‹è¾“å‡º
```

### 4. æŸ¥çœ‹åæ€æ—¥å¿—

åæ€è¿‡ç¨‹ä¼šè®°å½•åˆ° `logs/llm_interactions.log`ï¼š

```
================================================================================
ğŸ”„ åæ€æœºåˆ¶æ‰§è¡Œè®°å½• - 2025-11-19 15:30:00
================================================================================
è¿­ä»£æ¬¡æ•°: 1

åŸå§‹è¾“å‡º:
[Agentçš„åˆå§‹è¾“å‡º]

åæ€è¯„ä¼°:
[åæ€Agentçš„è¯„ä¼°ç»“æœ]

æœ€ç»ˆè¾“å‡º:
[æ”¹è¿›åçš„è¾“å‡º]
================================================================================
```

## å·¥ä½œåŸç†

### 1. æ‰§è¡ŒAgent
- Agentæ‰§è¡Œç”¨æˆ·è¯·æ±‚ï¼Œç”Ÿæˆåˆå§‹è¾“å‡º

### 2. åæ€è¯„ä¼°
- åæ€Agentè¯„ä¼°åˆå§‹è¾“å‡ºçš„è´¨é‡
- åˆ¤æ–­æ˜¯å¦éœ€è¦æ”¹è¿›

### 3. æ”¹è¿›è¾“å‡º
- å¦‚æœéœ€è¦æ”¹è¿›ï¼ŒåŸºäºåæ€ç»“æœç”Ÿæˆæ”¹è¿›åçš„è¾“å‡º

### 4. å¾ªç¯åˆ¤æ–­
- å¦‚æœè¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œç»“æŸ
- å¦‚æœä¸éœ€è¦æ”¹è¿›ï¼Œç»“æŸ
- å¦åˆ™ç»§ç»­åæ€

## ä¼˜åŠ¿

1. **è‡ªåŠ¨æ”¹è¿›**ï¼šæ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨è¯„ä¼°å’Œæ”¹è¿›è¾“å‡º
2. **å¯é…ç½®**ï¼šå¯ä»¥æ§åˆ¶æ˜¯å¦å¯ç”¨ã€è¿­ä»£æ¬¡æ•°ç­‰
3. **å¯è¿½è¸ª**ï¼šå®Œæ•´è®°å½•åæ€è¿‡ç¨‹ï¼Œä¾¿äºè°ƒè¯•
4. **å®¹é”™æ€§**ï¼šå¦‚æœåæ€æœºåˆ¶å‡ºé”™ï¼Œè‡ªåŠ¨å›é€€åˆ°æ™®é€šæ¨¡å¼

## æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½å½±å“**ï¼šåæ€æœºåˆ¶ä¼šå¢åŠ LLMè°ƒç”¨æ¬¡æ•°ï¼Œå¯èƒ½å½±å“å“åº”é€Ÿåº¦
2. **æˆæœ¬è€ƒè™‘**ï¼šæ¯æ¬¡åæ€éƒ½ä¼šè°ƒç”¨LLMï¼Œå¯èƒ½å¢åŠ APIæˆæœ¬
3. **é€‚ç”¨åœºæ™¯**ï¼šé€‚åˆå¯¹è¾“å‡ºè´¨é‡è¦æ±‚é«˜çš„åœºæ™¯ï¼Œç®€å•ä»»åŠ¡å¯èƒ½ä¸éœ€è¦

## ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¯ç”¨åæ€æœºåˆ¶

```python
# config.py
"reflection": {
    "enable": True,
    "max_iterations": 2,
}
```

### ç¤ºä¾‹2ï¼šæŸ¥çœ‹åæ€ç»“æœ

```python
result = agent_service.invoke_agent(
    agent_name="joke",
    user_input="è®²ä¸ªç¬‘è¯"
)

if "reflection_metadata" in result:
    print(f"è¿­ä»£æ¬¡æ•°: {result['reflection_metadata']['iterations']}")
    print(f"åŸå§‹è¾“å‡º: {result['reflection_metadata']['original_output']}")
    print(f"åæ€è¯„ä¼°: {result['reflection_metadata']['reflection']}")
```

## æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šLangGraphæœªå®‰è£…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âš ï¸ LangGraphæœªå®‰è£…ï¼Œæ— æ³•ä½¿ç”¨åæ€æœºåˆ¶
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
pip install langgraph>=0.2.0
```

### é—®é¢˜2ï¼šåæ€æœºåˆ¶å‡ºé”™

å¦‚æœåæ€æœºåˆ¶æ‰§è¡Œå‡ºé”™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°æ™®é€šæ¨¡å¼ï¼Œä¸ä¼šå½±å“æ­£å¸¸ä½¿ç”¨ã€‚

## ç›¸å…³æ–‡ä»¶

- `agents/enhancement/reflection_agent.py` - åæ€Agentå®ç°
- `agents/enhancement/reflection_graph.py` - LangGraphå·¥ä½œæµ
- `agents/strategies/reflection_strategy.py` - åæ€ç­–ç•¥å®ç°
- `agents/strategies/strategy_manager.py` - ç­–ç•¥ç®¡ç†å™¨
- `agents/base/base_agent.py` - AgentåŸºç±»
- `config.py` - é…ç½®æ–‡ä»¶

